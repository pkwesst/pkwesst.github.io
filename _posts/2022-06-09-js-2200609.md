---
layout: single
title: "[JS] 브라우저 렌더링 "
categories: JavaScript
tag: [JavaScript]

toc: true
toc_sticky: true
published: true
future: true

date: 2022-06-09
last_modified_at: 2022-06-11

---

## #1. 브라우저 렌더링 과정

1. 브라우저 창에 주소 입력하면 `DNS`가 해당 주소의 서버를 찾음  
  - 사용자가 브라우저 창에 'http://www.naver.com'이라고 입력하는 것은 컴퓨터가 이해할 수 없음 따라서 DNS(Domain Name System)이 주소를 컴퓨터가 이해할 수 있는 IP 주소로 변환해 주는 역할을 함  
  
2. `HTTP/HTTPS` 방식으로 통신  
  - HTTP
    - 서버와 클라이언트 모델을 따라 데이터를 주고 받기 위한 프로토콜(통신 규약)
  - HTTPS 
    - 데이터가 쉽게 도난 당할 수 있는 기존 프로토콜에서 `SSL`를 사용함으로써, 브라우저와 서버 사이의 연결을 암호화시켜 안전하게 하는 것
    - `TLS 프로토콜`은 데이터 무결성을 제공하여 데이터가 전송 중에 손상 또는 수정되는 것을 방지해줌
    - `검색엔진 최적화(SEO 도움)`에 도움이 됨
  - 차이점
    - HTTP는 암호화가 추가되어 있지 않아서 보안에 취약하고, HTTPS는 안전하게 데이터를 주고 받을 수 있음
 
3. HTML, CSS 리소스 파일을 브라우저에 보냄  


4. `웹 브라우저 엔진`이 텍스트 형태의 `리소스 파일 파싱` ⇒ 한 줄씩 읽으며 `DOM 트리 생성`
  - 중간에 link 태그 만나 CSS 요청 발생 시, CSS 파싱하며 CSSOM 트리 생성
  - 중간에 script 태그 만나 JS 요청 발생 시, 제어 권한을 웹 브라우저가 JS엔진에게 넘기고 JS코드/파일을 로드해 파싱


5. CSS/JS 파싱 완료되면 중단된 HTML 다시 읽어 `DOM 트리 완성`  
  - 4에서 생성하다 중단한 DOM 트리를 다시 이어서 생성해 DOM 트리를 완성함

6. DOM 트리와 CSSOM 트리로 `RENDER 트리` 구축


7. 뷰포트에 맞춰 RENDER 트리 배치


8. 픽셀을 화면에 Paint  
  - 최종 화면에 구현하는 것을 Paint라고 함

## #2. 브라우저 렌더링 과정에서 JS 동작 방법  

1. HTML/CSS 파싱 과정과 마찬가지로 `웹 브라우저 엔진`은 HTML을 한 줄씩 순차적으로 파싱하며 DOM을 생성하다가 JS 파일을 로드하는 `<sciprt>` 태그나 JS 코드를 콘텐츠로 담은 `<script>` 태그를 만나면 `DOM 생성을 일시 중단`  
  - 그래서 `<script>` 태그를 header 태그 내부가 아닌 body 태그의 마지막에 작성하는 것임 
  
2. <sciprt> 태그의 src 어트리뷰트에 정의된 자바스크립트 파일을 서버에 요청하여 로드한 JS 파일이나 <script> 태그 내의 JS 코드를 `파싱`하기 위해 `JS 엔진`에 제어권을 넘김. 이후 JS 파싱과 실행이 종료되면 `웹 브라우저 엔진`으로 다시 제어권을 넘겨 html 파싱이 중단된 지점부터 다시 html 파싱을 시작하여 `DOM 생성을 재개`  
  - JS 코드는 웹 브라우저 엔진이 아닌 JS엔진이 파싱함 따라서 이 과정에서 DOM 트리 생성이 중단됨
  
3. `JS 파싱`과 `실행`은 브라우저 렌더링 엔진이 아닌 `JS 엔진`이 처리함. JS 엔진은 JS 코드를 파싱하여 CPU가 이해할 수 있는 저수준 언어로 변환하고 실행하는 역할을 함  
  - 그래서 JS는 인터프리터 언어로 한 줄씩 해석하며 실행함
  
4. <sciprt> 태그의 src 어트리뷰트에 정의된 자바스크립트 파일을 서버에 요청하여 로드한 JS 파일이나 <script> 태그 내의 JS 코드를 `파싱`하기 위해 `JS 엔진`에 제어권을 넘김. 이후 JS 파싱과 실행이 종료되면 `웹 브라우저 엔진`으로 다시 제어권을 넘겨 html 파싱이 중단된 지점부터 다시 html 파싱을 시작하여 `DOM 생성을 재개`  
  
5. `JS 엔진`은 JS를 해석하여 `AST(Abstract Syntax Tree: 추상적 구문 트리)`를 생성함. 그리고 AST를 기반으로 인터프리터가 실행할 수 있는 중간 코드인 바이트코드를 생성하여 실행함  
  
6. `리플로우와 리페인트`  
    - JS 코드에 DOM이나 CSSOM(CSS Object Model)을 변경하는 `DOM API`가 사용된 경우 DOM이나 CSSOM이 변경됨  
    - 이때 변경된 DOM과 CSSOM은 다시 렌더 트리로 결합되고 `변경된 렌더 트리`를 기반으로 레이아웃과 페인트 과정을 거쳐 브라우저의 화면에 `다시 렌더링`됨. 이를 리플로우, 리페인트라고 함  
  
## #3. 용어 정리  
  
### ✅ 컴파일러  

- 소스 코드를 기계어로 전체를 번역해 실행 파일 생성  

### ✅ 컴파일  

- parsing tree를 기계 코드로 변환  

### ✅ 인터프리터  

- 소스 코드를 기계어로 한 줄씩 해석해서 바로 명령어를 실행  

### ✅ 파싱  

- 브라우저가 코드를 이해하고 사용할 수 있는 구조로 변환하는 것  
  
1. 어휘 분석 ⇒ `어휘 분석기`  
    - 자료를 토큰으로 변경(공백, 줄바꿈 제거 등)  
  
2. 구문 분석 ⇒ `파서`  
    - 언어 구문 규칙에 따라 문서 구조를 분석해 parsing tree 생성  

### ✅ 파서  

- HTML 마크업 ⇒ DOM으로 변환  
- CSS 마크업 ⇒ CSSOM으로 변환  

### ✅ DOM TREE  

- HTML 파일 파싱  
- parsing tree로 구성되어 있음  

### ✅ CSSOM TREE  

- CSS 파일 파싱, 스타일 규칙  

### ✅ RENDER TREE  

- DOM TREE + CSSOM TREE  
  
